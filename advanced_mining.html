
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Mining &#8212; egrin2-tools 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="TUTORIAL: Visualizing Basic EGRIN 2.0 queries" href="plot_expression_tutorial.html" />
    <link rel="prev" title="Basic Mining Using coremFinder" href="basic_mining_coremfinder.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="advanced-mining">
<h1>Advanced Mining<a class="headerlink" href="#advanced-mining" title="Permalink to this headline">¶</a></h1>
<div class="section" id="in-a-nutshell">
<h2>In a nutshell<a class="headerlink" href="#in-a-nutshell" title="Permalink to this headline">¶</a></h2>
<p>Information hosted in the EGRIN 2.0 MongoDB databases can be used directly to extend EGRIN 2.0 queries and analysis.</p>
</div>
<div class="section" id="set-up">
<h2>Set-up<a class="headerlink" href="#set-up" title="Permalink to this headline">¶</a></h2>
<p>As usual, make sure <code class="docutils literal"><span class="pre">./egrin-tools/`</span> <span class="pre">folder</span> <span class="pre">is</span> <span class="pre">in</span> <span class="pre">your</span> <span class="pre">``$PYTHONPATH</span></code>.
You can do this on Mac/Linux by adding the path to you Bash Shell Startup Files, e.g. <code class="docutils literal"><span class="pre">~/.bashrc</span></code> or <code class="docutils literal"><span class="pre">~/.bash_profile</span></code></p>
<p>for example in <code class="docutils literal"><span class="pre">~/.bash_profile</span></code> add the following line:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>export PYTHONPATH=$PYTHONPATH:path/to/egrin2-tools/
</pre></div>
</div>
</div>
<div class="section" id="load-required-modules">
<h2>Load required modules<a class="headerlink" href="#load-required-modules" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre><span></span>import query.egrin2_query as e2q
import pymongo
import pandas as pd

client = pymongo.MongoClient(host=&#39;localhost&#39;)
db = client[&#39;eco_db&#39;]
</pre></div>
</div>
<p>There are several dependencies that need to be satisfied, including:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">pymongo</span></code></li>
<li><code class="docutils literal"><span class="pre">numpy</span></code></li>
<li><code class="docutils literal"><span class="pre">pandas</span></code></li>
<li><code class="docutils literal"><span class="pre">joblib</span></code></li>
<li><code class="docutils literal"><span class="pre">scipy</span></code></li>
<li><code class="docutils literal"><span class="pre">statsmodels</span></code></li>
<li><code class="docutils literal"><span class="pre">itertools</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="run-agglom-function">
<h2>Run agglom function<a class="headerlink" href="#run-agglom-function" title="Permalink to this headline">¶</a></h2>
<p><strong>Example 1: Find genes co-regulated in biclusters with the gene carA (b0032)</strong></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>carA_genes = e2q.agglom(db, x=&quot;b0032&quot;, x_type=&quot;genes&quot;, y_type=&quot;genes&quot;)
carA_genes
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="10%" />
<col width="16%" />
<col width="21%" />
<col width="21%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">gene</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>b0032</td>
<td>198</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-odd"><td>b0033</td>
<td>173</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-even"><td>b4245</td>
<td>169</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-odd"><td>b4244</td>
<td>167</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-even"><td>b0337</td>
<td>154</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-odd"><td>b0336</td>
<td>153</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-even"><td>b1062</td>
<td>152</td>
<td>198</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
<td>0.000000e+00</td>
</tr>
<tr class="row-odd"><td>b2476</td>
<td>142</td>
<td>198</td>
<td>3.783051e-300</td>
<td>4.073085e-298</td>
<td>3.665776e-297</td>
</tr>
<tr class="row-even"><td>b2499</td>
<td>142</td>
<td>198</td>
<td>3.783051e-300</td>
<td>4.073085e-298</td>
<td>3.665776e-297</td>
</tr>
<tr class="row-odd"><td>b2312</td>
<td>141</td>
<td>198</td>
<td>5.664712e-297</td>
<td>4.574255e-295</td>
<td>5.489106e-294</td>
</tr>
<tr class="row-even"><td>b2313</td>
<td>141</td>
<td>198</td>
<td>5.664712e-297</td>
<td>4.574255e-295</td>
<td>5.489106e-294</td>
</tr>
<tr class="row-odd"><td>b2557</td>
<td>141</td>
<td>198</td>
<td>5.664712e-297</td>
<td>4.574255e-295</td>
<td>5.489106e-294</td>
</tr>
<tr class="row-even"><td>b0522</td>
<td>138</td>
<td>198</td>
<td>1.477589e-287</td>
<td>1.101372e-285</td>
<td>1.431783e-284</td>
</tr>
<tr class="row-odd"><td>b1849</td>
<td>136</td>
<td>198</td>
<td>2.280977e-281</td>
<td>1.578762e-279</td>
<td>2.210267e-278</td>
</tr>
<tr class="row-even"><td>b4006</td>
<td>132</td>
<td>198</td>
<td>3.382871e-269</td>
<td>2.185335e-267</td>
<td>3.278002e-266</td>
</tr>
<tr class="row-odd"><td>b0523</td>
<td>129</td>
<td>198</td>
<td>3.043903e-260</td>
<td>1.843464e-258</td>
<td>2.949542e-257</td>
</tr>
<tr class="row-even"><td>b3654</td>
<td>128</td>
<td>198</td>
<td>2.728256e-257</td>
<td>1.555106e-255</td>
<td>2.643680e-254</td>
</tr>
<tr class="row-odd"><td>b4246</td>
<td>126</td>
<td>198</td>
<td>1.964952e-251</td>
<td>1.057799e-249</td>
<td>1.904038e-248</td>
</tr>
<tr class="row-even"><td>b2500</td>
<td>122</td>
<td>198</td>
<td>6.646122e-240</td>
<td>3.389522e-238</td>
<td>6.440093e-237</td>
</tr>
<tr class="row-odd"><td>b2497</td>
<td>112</td>
<td>198</td>
<td>4.061863e-212</td>
<td>1.967973e-210</td>
<td>3.935945e-209</td>
</tr>
<tr class="row-even"><td>b4064</td>
<td>102</td>
<td>198</td>
<td>9.823972e-186</td>
<td>4.533061e-184</td>
<td>9.519429e-183</td>
</tr>
<tr class="row-odd"><td>b0945</td>
<td>96</td>
<td>198</td>
<td>1.511792e-170</td>
<td>6.658758e-169</td>
<td>1.464927e-167</td>
</tr>
<tr class="row-even"><td>b4005</td>
<td>89</td>
<td>198</td>
<td>2.020583e-153</td>
<td>8.512805e-152</td>
<td>1.957945e-150</td>
</tr>
<tr class="row-odd"><td>b3941</td>
<td>58</td>
<td>198</td>
<td>3.940658e-85</td>
<td>1.591041e-83</td>
<td>3.818498e-82</td>
</tr>
<tr class="row-even"><td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>259 rows × 5 columns</p>
<p>There are several things to note in this query.</p>
<p>First the arguments:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">x</span></code> specfies the query. This can be gene(s), condition(s), GRE(s), or bicluster(s). x can be a single entity or a list of entitites of the same type.</li>
<li><code class="docutils literal"><span class="pre">x_type</span></code> indicates the type of x. This can include gene, condition, gres, and biclusters. Basically: what is x? The parameter typing is pretty flexible, so - for example - rows can be used instead of genes.</li>
<li><code class="docutils literal"><span class="pre">y_type</span></code> is the type of. Again, genes, conditions, gres, or biclusters.</li>
<li><code class="docutils literal"><span class="pre">host</span></code> specifies where the MongoDB database is running. In this case it is running on a machine called primordial (my box). If you are hosting the database locally this would be localhost</li>
<li><code class="docutils literal"><span class="pre">db</span></code> is the name of the database you want to perform the query in. Typically databases are specified by the three letter organism code (e.g., eco) followed by _db.</li>
</ul>
</div></blockquote>
<p>Also note the output:</p>
<p>This is a table of all genes that are frequently co-discovered in biclusters with b0032 (carA). They are sorted by their relative “enrichment” in the sample x (where lower pval = greater enrichment). This is quantified by the hypergeometric distribution. To account for multiple testing, two corrections are included: Benjamini-Hochber correction (qval_BH; less stringent) and Bonferrnoni correction (qval_bonferroni; more stringent).</p>
<p>We can easily change the format of x, which makes it easy to specify genes in any format. Let’s try to include a list of genes with two different naming formats. This time we will only return the first few elements using .head()</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>e2q.agglom(db, x=[&quot;b0032&quot;,&quot;pyrL&quot;,&quot;b0031&quot;], x_type=&quot;genes&quot;, y_type=&quot;genes&quot;).head()
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="13%" />
<col width="21%" />
<col width="9%" />
<col width="15%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">gene</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>b4244</td>
<td>179</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>b0033</td>
<td>180</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>b4245</td>
<td>185</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>b0031</td>
<td>198</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>b4246</td>
<td>198</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>5 rows × 5 columns</p>
<p>The lookup table is pretty extensive for genes (it comes from MicrobesOnline) so anything from common name to GI number can be matched. Cool, huh?</p>
<p>You can also specify the type of logic to use in grouping your query. For example, do you want do find biclusters where all genes x in your query are present (and logic) or biclusters where at least one of the genes is present (or logic). You can change the logical grouping of your query by specifying the logic parameter. This parameter can take one of three values: <code class="docutils literal"><span class="pre">and</span></code>, <code class="docutils literal"><span class="pre">o``r,</span> <span class="pre">or</span> <span class="pre">``nor</span></code>. By default the command uses and logic.</p>
<p>Here we change the logic employed in the previous query. Notice how the values change.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>e2q.agglom(db, x=[&quot;b0032&quot;,&quot;pyrL&quot;,&quot;b0031&quot;], x_type=&quot;genes&quot;, y_type=&quot;genes&quot;, logic=&quot;or&quot;).head()
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="13%" />
<col width="21%" />
<col width="9%" />
<col width="15%" />
<col width="32%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">gene</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>b4244</td>
<td>179</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>b0033</td>
<td>180</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>b4245</td>
<td>185</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>b0031</td>
<td>198</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>b4246</td>
<td>198</td>
<td>198</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>5 rows × 5 columns</p>
<p>Logical operations can provide a substantial amount of power to your queries. For example, imagine that you not only want to know when b0032, pyrL, and b0031 are co-regulated but also when they are not. This can be done using the logical operator nor.</p>
<p>First we query for conditions where they are co-regulated:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>e2q.agglom(db, x=[&quot;b0032&quot;,&quot;pyrL&quot;,&quot;b0031&quot;], x_type=&quot;genes&quot;, y_type=&quot;conditions&quot;, logic=&quot;or&quot;).head()
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="14%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">condition</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>rb_del_rpoS_biofilm</td>
<td>240</td>
<td>12921</td>
<td>2.849586e-13</td>
<td>7.228851e-11</td>
<td>1.327907e-10</td>
</tr>
<tr class="row-odd"><td>biofilm_24hr_del_yceP</td>
<td>239</td>
<td>12879</td>
<td>3.889790e-13</td>
<td>7.228851e-11</td>
<td>1.812642e-10</td>
</tr>
<tr class="row-even"><td>ik_H2_T4</td>
<td>232</td>
<td>12380</td>
<td>4.653767e-13</td>
<td>7.228851e-11</td>
<td>2.168655e-10</td>
</tr>
<tr class="row-odd"><td>MG1063_uninduced_t180</td>
<td>232</td>
<td>12543</td>
<td>2.190004e-12</td>
<td>2.551355e-10</td>
<td>1.020542e-09</td>
</tr>
<tr class="row-even"><td>rb_del_rpoS_exponential</td>
<td>226</td>
<td>12198</td>
<td>5.366065e-12</td>
<td>5.001173e-10</td>
<td>2.500586e-09</td>
</tr>
</tbody>
</table>
<p>5 rows × 5 columns</p>
<p>Now we can compare these conditions to conditions that are exluded from biclusters where at least one of the genes is present:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>e2q.agglom(db, x=[&quot;b0032&quot;,&quot;pyrL&quot;,&quot;b0031&quot;], x_type=&quot;genes&quot;, y_type= &quot;conditions&quot;, log
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="7%" />
<col width="11%" />
<col width="13%" />
<col width="9%" />
<col width="16%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">condition</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>har_S0_R_noIPTG</td>
<td>12933</td>
<td>13045</td>
<td>2.442307e-09</td>
<td>0.000001</td>
<td>0.000001</td>
</tr>
<tr class="row-odd"><td>MOPS_K_dps_stationary2</td>
<td>10149</td>
<td>10230</td>
<td>5.916970e-09</td>
<td>0.000001</td>
<td>0.000003</td>
</tr>
<tr class="row-even"><td>BW25113_K_tnaA_30C_biofilm_indole_control</td>
<td>11308</td>
<td>11403</td>
<td>9.537266e-09</td>
<td>0.000001</td>
<td>0.000004</td>
</tr>
<tr class="row-odd"><td>MG1655_kanamycin_t60</td>
<td>11240</td>
<td>11337</td>
<td>5.362424e-08</td>
<td>0.000006</td>
<td>0.000025</td>
</tr>
<tr class="row-even"><td>dilution_t3</td>
<td>12110</td>
<td>12219</td>
<td>1.446307e-07</td>
<td>0.000013</td>
<td>0.000067</td>
</tr>
</tbody>
</table>
<p>5 rows × 5 columns</p>
<p>Understanding condition-specific co-regulation of gene modules is what EGRIN 2.0 is all about. Because MongoDB allows for flexible document structures, we’ve included options for rich experimental annotation. Providing details about what is going on in an experiment (metainformation) provides an additional layer of inquiry (and hopefully insight). In the next few examples, I demonstrate how you might use the experimental annotations in interesting ways.</p>
<p>First, let’s get an idea for what these experimental annotations might look like. Let’s use the condition called rb_del_rpoS_biofilm that came up as a condition where b0032, pyrL, and b0031 are co-regulated.</p>
<p>To do this we need to connect to the database.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client = pymongo.MongoClient(host=&quot;localhost&quot;, port=27017 )
</pre></div>
</div>
<p>Now we can query the col_info collection in our database. Here I am just returning the field called additional_info, which is where we store all of the optional annotations. These annotations come directly from the M3D database. The full databse schema is available for your reference on the wiki.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>client[&quot;eco_db&quot;].col_info.find_one({&quot;egrin2_col_name&quot;: &quot;rb_del_rpoS_biofilm&quot;}, {&quot;_id&quot;: 0, &quot;additional_info&quot;: 1})
{u&#39;additional_info&#39;: [{u&#39;name&#39;: u&#39;aeration&#39;,
   u&#39;units&#39;: nan,
   u&#39;value&#39;: u&#39;assumed_anaerobic&#39;},
  {u&#39;name&#39;: u&#39;ammonium_chloride&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;9.52&#39;},
  {u&#39;name&#39;: u&#39;ammonium_molybdate&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.00000291&#39;},
  {u&#39;name&#39;: u&#39;boric_acid&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.000401&#39;},
  {u&#39;name&#39;: u&#39;calcium_chloride&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.0005&#39;},
  {u&#39;name&#39;: u&#39;cobalt_chloride&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.0000303&#39;},
  {u&#39;name&#39;: u&#39;culture_temperature&#39;, u&#39;units&#39;: u&#39;Celsius&#39;, u&#39;value&#39;: u&#39;37&#39;},
  {u&#39;name&#39;: u&#39;culture_type&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;fed_batch&#39;},
  {u&#39;name&#39;: u&#39;culture_vessel&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;flow cell&#39;},
  {u&#39;name&#39;: u&#39;cupric_sulfate&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.00000961&#39;},
  {u&#39;name&#39;: u&#39;experimenter&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;Ito A&#39;},
  {u&#39;name&#39;: u&#39;ferrous_sulfate&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.01&#39;},
  {u&#39;name&#39;: u&#39;glucose&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;11.1&#39;},
  {u&#39;name&#39;: u&#39;growth_phase&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;biofilm&#39;},
  {u&#39;name&#39;: u&#39;magnesium_chloride&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.525&#39;},
  {u&#39;name&#39;: u&#39;manganese(II)_chloride&#39;,
   u&#39;units&#39;: u&#39;mM&#39;,
   u&#39;value&#39;: u&#39;0.0000808&#39;},
  {u&#39;name&#39;: u&#39;MOPS&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;40&#39;},
  {u&#39;name&#39;: u&#39;note&#39;,
   u&#39;units&#39;: nan,
   u&#39;value&#39;: u&#39;channel dimensions: 1x4x40 mm, medium pumped thru at 0.25 mL/min, samples taken at 72 hrs&#39;},
  {u&#39;name&#39;: u&#39;perturbation&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;knockout&#39;},
  {u&#39;name&#39;: u&#39;perturbation_gene&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;rpoS&#39;},
  {u&#39;name&#39;: u&#39;potassium_phosphate_monobasic&#39;,
   u&#39;units&#39;: u&#39;mM&#39;,
   u&#39;value&#39;: u&#39;1.32&#39;},
  {u&#39;name&#39;: u&#39;potassium_sulfate&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.276&#39;},
  {u&#39;name&#39;: u&#39;RNA_prep_type&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;RNeasy&#39;},
  {u&#39;name&#39;: u&#39;RNA_stop_solution&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;RNAprotect&#39;},
  {u&#39;name&#39;: u&#39;sodium_chloride&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;50&#39;},
  {u&#39;name&#39;: u&#39;strain&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;MG1655 del rpoS&#39;},
  {u&#39;name&#39;: u&#39;structured_metadata&#39;, u&#39;units&#39;: nan, u&#39;value&#39;: u&#39;complete&#39;},
  {u&#39;name&#39;: u&#39;thiamine_HCl&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.2964&#39;},
  {u&#39;name&#39;: u&#39;tricine&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;4&#39;},
  {u&#39;name&#39;: u&#39;zinc_sulfate&#39;, u&#39;units&#39;: u&#39;mM&#39;, u&#39;value&#39;: u&#39;0.00000974&#39;}]}
</pre></div>
</div>
<p>Notice that each optional annotation has name, units, and value fields. We can take advatage of this information and the nice query features of MongoDB to compose more powerful queries.</p>
<p>For example, you might have noticed in our original query that several conditions with biofilm in their titles came up. Maybe our genes play some role in biofilm-related processes? Let’s see if we can return all genes that are co-regulated in conditions where growth_phase is biofim.</p>
<p>To do that we need to retrieve all of the conditions where growth_phase is biofilm.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>biofilm_conds = pd.DataFrame(list(client[&quot;eco_db&quot;].col_info.find({&quot;additional_info.name&quot;: &quot;growth_phase&quot;, &quot;additional_info.value&quot;: &quot;biofilm&quot;}, {&quot;_id&quot;: 0, &quot;egrin2_col_name&quot;: 1})))

print biofilm_conds.head()

  egrin2_col_name
0 biofilm_K_yceP
1 biofilm_K_yceP_indole
2 biofilm_wt_glucose
3 biofilm_K_trpE
4 biofilm_K_tnaA

[5 rows x 1 columns]

biofilm_conds.count()

egrin2_col_name    46
dtype: int64
</pre></div>
</div>
<p>There are 46 conditions annotated as biofilm. Just for fun, let’s say we wanted restrict these conditions to those where the strain used was <em>E. coli K-12 MG1655.</em></p>
<div class="highlight-none"><div class="highlight"><pre><span></span>biofilm_conds_MG1655 = pd.DataFrame(list(client[&quot;eco_db&quot;].col_info.find({&quot;$and&quot;: [{&quot;additional_info.name&quot;: &quot;strain&quot;, &quot;additional_info.value&quot;: {&quot;$regex&quot;: &quot;MG1655&quot; } }, { &quot;additional_info.name&quot;: &quot;growth_phase&quot;, &quot;additional_info.value&quot;: &quot;biofilm&quot;}]}, {&quot;_id&quot;:0, &quot;egrin2_col_name&quot;: 1})))

biofilm_conds_MG1655.head()
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">#</th>
<th class="head">egrin2_col_name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>MG1655_wt_24hr_biofilm</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>MG1655_wt_R1drd19_24hr_biofilm</td>
</tr>
<tr class="row-even"><td>2</td>
<td>rb_del_rpoS_biofilm</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>rb_wt_biofilm</td>
</tr>
<tr class="row-even"><td>4</td>
<td>bform_biofilm_attachment</td>
</tr>
</tbody>
</table>
<div class="highlight-none"><div class="highlight"><pre><span></span>biofilm_conds_MG1655.count()
egrin2_col_name    11
dtype: int64
</pre></div>
</div>
<p>You can see that these 11 are a subset of the 46 originally returned. This query highlights some features of MongoDB queries. Here we’ve used a regular expression to find documents where the strain annotation contained the values “MG1655”. You can also find documents by value comparisons (e.g. equalities/inequalities). The document searching capabilities of MongoDB are pretty extensive. You can learn more about query operators in MongoDB here.</p>
<p>Now we can find the genes that are co-regulated in the 11 experiments where the growth phase was biofilm. Here I will use the and logical operator, which would be the most stringent criteria (i.e. all conditions must be present in the bicluster).</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>biofilm_genes = e2q.agglom(db, x=biofilm_conds_MG1655.egrin2_col_name.tolist(), x_type=&quot;conditions&quot;, y_type=&quot;genes&quot;, logic=&quot;and&quot;)

print biofilm_genes.head()
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="12%" />
<col width="19%" />
<col width="15%" />
<col width="15%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">gene</th>
<th class="head">counts</th>
<th class="head">all_counts</th>
<th class="head">pval</th>
<th class="head">qval_BH</th>
<th class="head">qval_bonferroni</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>b3963</td>
<td>4</td>
<td>198</td>
<td>0.000005</td>
<td>0.001972</td>
<td>0.003943</td>
</tr>
<tr class="row-odd"><td>b2796</td>
<td>4</td>
<td>198</td>
<td>0.000005</td>
<td>0.001972</td>
<td>0.003943</td>
</tr>
<tr class="row-even"><td>b3774</td>
<td>3</td>
<td>198</td>
<td>0.000116</td>
<td>0.002955</td>
<td>0.088654</td>
</tr>
<tr class="row-odd"><td>b4443</td>
<td>3</td>
<td>198</td>
<td>0.000116</td>
<td>0.002955</td>
<td>0.088654</td>
</tr>
<tr class="row-even"><td>b3357</td>
<td>3</td>
<td>198</td>
<td>0.000116</td>
<td>0.002955</td>
<td>0.088654</td>
</tr>
</tbody>
</table>
<p>[5 rows x 5 columns]</p>
<p>We can restrict this list to genes that surpass a multiple testing correction at a qval threshold of 0.05.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>biofilm_genes_sig = biofilm_genes.qval_BH[biofilm_genes.qval_BH &lt; 0.05]
biofilm_genes_sig.shape[0]
761
</pre></div>
</div>
<p>There are 761 genes that meet our criteria. Now we can see if our genes are in this list.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>&quot;b0032&quot; in biofilm_genes.qval_BH[biofilm_genes.qval_BH &lt; 0.05]
True

e2q.row2id_batch(db, [&quot;pyrL&quot;], return_field = &quot;egrin2_row_name&quot;)[0] in biofilm_genes.qval_BH[biofilm_genes.qval_BH &lt; 0.05]
False

&quot;b0031&quot; in biofilm_genes.qval_BH[biofilm_genes.qval_BH &lt; 0.05]
False
</pre></div>
</div>
<p>So 1 out of 3 of our genes occur frequently in biolfim annotated conditions. Not very strong support for our hypothesis.</p>
<p>In this example, however, we also see an example of name translation using the row2id_batch() function. Here we need to translate the common name pyrL to the name used in EGRIN 2.0, b4246. We did that as follows:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>print e2q.row2id_batch(db, [&quot;pyrL&quot;], return_field=&quot;egrin2_row_name&quot;)[0]
b4246
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/egrin2_logo_80px.png" alt="Logo"/>
    
    <h1 class="logo logo-name">egrin2-tools</h1>
    
  </a>
</p>



<p class="blurb">EGRIN2 tool chain</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=baliga-lab&repo=egrin2-tools&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Build</a></li>
<li class="toctree-l1"><a class="reference internal" href="build_tutorial.html">Build Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">Postprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="assemble.html">Assemble</a></li>
<li class="toctree-l1"><a class="reference internal" href="assemble_tutorial.html">Assemble Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="query.html">Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_mining_agglom.html">Basic Mining Using agglom</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_mining_coremfinder.html">Basic Mining Using coremFinder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Mining</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#in-a-nutshell">In a nutshell</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-up">Set-up</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-required-modules">Load required modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-agglom-function">Run agglom function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plot_expression_tutorial.html">Plot Expression Tutorial</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="basic_mining_coremfinder.html" title="previous chapter">Basic Mining Using <code class="docutils literal"><span class="pre">coremFinder</span></code></a></li>
      <li>Next: <a href="plot_expression_tutorial.html" title="next chapter">TUTORIAL: Visualizing Basic <cite>EGRIN 2.0</cite> queries</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Aaron Brooks, David Reiss, Wei-ju Wu, Micheleen Harris.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/advanced_mining.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/baliga-lab/egrin2-tools" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>